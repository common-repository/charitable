var CharitableCampaignBuilderFieldHTML=window.CharitableCampaignBuilderFieldHTML||function(document,window,$){var $builder,cm_editor=false,cm_field_ids=[];var app={settings:{},init:function(){wpchar.debug("init","field-html-js");var that=this;charitable_panel_switch=true;s=this.settings;$(app.ready);$(window).on("load",(function(){if(typeof $.ready.then==="function"){$.ready.then(app.load)}else{app.load()}}))},ready:function(){wpchar.debug("ready","field-html-js");$builder=$("#charitable-builder");$builder.on("charitableFieldEdit",(function(event,type,section,edit_field_id,field_id,field_type){if(field_type!=="html"){return}if(edit_field_id==""&&field_id!==""){edit_field_id=field_id}if(parseInt(edit_field_id)>0&&cm_field_ids.indexOf(edit_field_id)===-1){wpchar.debug("init a codemirror at "+edit_field_id,"field-html-js");app.codemirrorInit(edit_field_id)}}))},codemirrorInit(edit_field_id){var cm_editorSettings=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{},field_object=$("#charitable-panel-field-settings-field_html_html_"+edit_field_id);wpchar.debug("field_object","field-html-js");wpchar.debug(field_object,"field-html-js");if(field_object.parent().find(".CodeMirror").length>0){wpchar.debug("already codemirror");return}cm_editorSettings.codemirror=_.extend({},cm_editorSettings.codemirror,{lineNumbers:true,indentUnit:2,tabSize:2});wpchar.debug("charitable_codemirror_init","field-html-js");wpchar.debug($("#charitable-panel-field-settings-field_html_html_"+edit_field_id),"field-html-js");wpchar.debug(edit_field_id,"field-html-js");field_object.css("visibility","hidden");setTimeout((function(){cm_editor=wp.codeEditor.initialize(field_object);field_object.css("visibility","visible")}),500);cm_field_ids.indexOf(edit_field_id)===-1?cm_field_ids.push(edit_field_id):console.log("This item already exists");wpchar.debug(cm_field_ids,"field-html-js");$builder=$("#charitable-builder");$builder.on("keyup",".CodeMirror-code",(function(){cm_editor.codemirror.save();var $textarea=$("#charitable-panel-field-settings-field_html_html_"+edit_field_id);$textarea.trigger("change");wpchar.debug($(this),"field-html-js");wpchar.debug($textarea,"field-html-js");wpchar.debug(cm_editor.codemirror.getValue(),"field-html-js")}))}};return app}(document,window,jQuery);CharitableCampaignBuilderFieldHTML.init();